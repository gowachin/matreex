<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="matreex">
<title>Harvesting models • matreex</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Harvesting models">
<meta property="og:description" content="matreex">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">matreex</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/matreex.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Harvesting.html">Harvesting models</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/gowachin/matreex" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Harvesting models</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/gowachin/matreexvignettes/Harvesting.Rmd" class="external-link"><code>vignettes/Harvesting.Rmd</code></a></small>
      <div class="d-none name"><code>Harvesting.Rmd</code></div>
    </div>

    
    
<p>This vignette illustrates how to use harvesting scenarii with
<code>{matreex}</code> package. An harvesting scenario provides the
rules and the periodicity to trigger harvesting of trees in each size
classes. The harvested trees are saved and exported for each simulation
time step.</p>
<p>The basic <code>{matreex}</code> functions are shown in <a href="matreex.html">a previous introduction vignette</a>.</p>
<div class="section level2">
<h2 id="simulations-input">Simulations input<a class="anchor" aria-label="anchor" href="#simulations-input"></a>
</h2>
<div class="section level3">
<h3 id="define-a-species">Define a species<a class="anchor" aria-label="anchor" href="#define-a-species"></a>
</h3>
<p>The first step is the IPM integration. This part is common with basic
usage of the package, so nothing is very important here.</p>
<p><strong>Please keep in mind this computation is intensive and may
take few minutes !</strong></p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">matreex</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load fitted model for a species</span></span>
<span><span class="co"># fit_species # list of all species in dataset</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"fit_Picea_abies"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load associated climate</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"climate_species"</span><span class="op">)</span></span>
<span><span class="va">climate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">climate_species</span>, <span class="va">N</span> <span class="op">==</span> <span class="fl">2</span> <span class="op">&amp;</span> <span class="va">sp</span> <span class="op">==</span> <span class="st">"Picea_abies"</span>, select <span class="op">=</span> <span class="op">-</span><span class="va">sp</span><span class="op">)</span></span>
<span><span class="co"># see ?climate_species to understand the filtering of N.</span></span>
<span><span class="va">climate</span></span>
<span><span class="co">#&gt;        sgdd       wai        sgddb      waib      wai2   sgdd2      PC1</span></span>
<span><span class="co">#&gt; 62 1444.667 0.4519387 0.0006922012 0.6887343 0.2042486 2087062 1.671498</span></span>
<span><span class="co">#&gt;           PC2 N       SDM</span></span>
<span><span class="co">#&gt; 62 0.02602064 2 0.6760556</span></span>
<span></span>
<span><span class="va">Picea_ipm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_IPM.html">make_IPM</a></span><span class="op">(</span></span>
<span>    species <span class="op">=</span> <span class="st">"Picea_abies"</span>, </span>
<span>    climate <span class="op">=</span> <span class="va">climate</span>, </span>
<span>    fit <span class="op">=</span> <span class="va">fit_Picea_abies</span>,</span>
<span>    clim_lab <span class="op">=</span> <span class="st">"optimum clim"</span>, </span>
<span>    mesh <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>m <span class="op">=</span> <span class="fl">700</span>, L <span class="op">=</span> <span class="fl">90</span>, U <span class="op">=</span> <span class="fu"><a href="../reference/get_maxdbh.html">get_maxdbh</a></span><span class="op">(</span><span class="va">fit_Picea_abies</span><span class="op">)</span> <span class="op">*</span> <span class="fl">1.1</span><span class="op">)</span>,</span>
<span>    BA <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">70</span>, <span class="co"># Default values are 0:200, smaller values speed up this vignette.</span></span>
<span>    verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Launching integration loop</span></span>
<span><span class="co">#&gt; GL integration occur on 32 cells</span></span>
<span><span class="co">#&gt; midbin integration occur on 25 cells</span></span>
<span><span class="co">#&gt; Loop done.</span></span>
<span><span class="co">#&gt; Time difference of 1 mins</span></span></code></pre></div>
<p>Harvesting scenario are defined at different levels: at the species
level with the species harvesting function and its associated
parameters, at the forest level with a set of parameters, and at the
simulation level with the target of the harvesting scenario. Depending
on the scenario used, not all the parameters are used. The table below
summarise the required parameters for each scenario. Each scenario have
an example in the following document.</p>
<table class="table">
<colgroup>
<col width="20%">
<col width="20%">
<col width="20%">
<col width="20%">
<col width="20%">
</colgroup>
<thead><tr class="header">
<th>Harvesting scenario</th>
<th>Species harvesting function</th>
<th>Species parameters</th>
<th>Forest parameters</th>
<th>Simulation parameters</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>default</td>
<td>
<code><a href="../reference/def_harv.html">def_harv()</a></code> <br> or custom by user.</td>
<td><span class="math inline">\(\emptyset\)</span></td>
<td><code>harv_rules["freq"]</code></td>
<td><span class="math inline">\(\emptyset\)</span></td>
</tr>
<tr class="even">
<td>Uneven</td>
<td><code><a href="../reference/Uneven_harv.html">Uneven_harv()</a></code></td>
<td><code>harv_lim</code></td>
<td><code>harv_rules</code></td>
<td><code>targetBA</code></td>
</tr>
<tr class="odd">
<td>Even <br><em>in active dev</em>
</td>
<td><code><a href="../reference/Even_harv.html">Even_harv()</a></code></td>
<td><code>rdi_coef</code></td>
<td>
<code>harv_rules</code> <!--`FinalHarvT`-->
</td>
<td>
<code>targetRDI</code> <br><code>targetKg</code>
</td>
</tr>
</tbody>
</table>
<p>Short example : When using an Uneven scenario, each species needs to
use the <code><a href="../reference/Uneven_harv.html">Uneven_harv()</a></code> function with <code>harv_lim</code>
parameters. The forest will need to have <code>harv_rules</code>
parameters. The <code><a href="../reference/sim_deter_forest.html">sim_deter_forest()</a></code> require
<code>targetBA</code> argument. If <code>targetRDI</code> is defined, it
will not be used.</p>
</div>
</div>
<div class="section level2">
<h2 id="default-scenario">Default scenario<a class="anchor" aria-label="anchor" href="#default-scenario"></a>
</h2>
<div class="section level3">
<h3 id="presentation">Presentation<a class="anchor" aria-label="anchor" href="#presentation"></a>
</h3>
<p>The default scenario is based on <span class="citation">Kunstler et
al. (<a href="#ref-kunstler2021" role="doc-biblioref">2021</a>)</span>.
This mean there is a constant harvest rate triggered each year. This
harvest rate is uniform over the size distribution. This is the scenario
used by default.</p>
<p>This rate is coded in <code><a href="../reference/def_harv.html">def_harv()</a></code> function as shown below
and the frequency (each year) is given in
<code>harv_rules["freq"]</code>. Note that the harvesting is applied to
all size class except the age-classes used in delay (with
<code>* (ct &gt; 0)</code>).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">def_harv</span></span>
<span><span class="co">#&gt; function (x, species, ...) </span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;     dots &lt;- list(...)</span></span>
<span><span class="co">#&gt;     ct &lt;- dots$ct</span></span>
<span><span class="co">#&gt;     rate &lt;- 0.006 * (ct &gt; 0)</span></span>
<span><span class="co">#&gt;     return(x * rate)</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; &lt;bytecode: 0x56155f62a5c0&gt;</span></span>
<span><span class="co">#&gt; &lt;environment: namespace:matreex&gt;</span></span>
<span><span class="va">Picea_sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/species.html">species</a></span><span class="op">(</span>IPM <span class="op">=</span> <span class="va">Picea_ipm</span>, init_pop <span class="op">=</span> <span class="fu"><a href="../reference/def_initBA.html">def_initBA</a></span><span class="op">(</span><span class="fl">30</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Picea_for</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/forest.html">forest</a></span><span class="op">(</span>species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Picea <span class="op">=</span> <span class="va">Picea_sp</span><span class="op">)</span>, </span>
<span>                    harv_rules <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>Pmax <span class="op">=</span> <span class="fl">0.25</span>, dBAmin <span class="op">=</span> <span class="fl">3</span>, </span>
<span>                                   freq <span class="op">=</span> <span class="fl">1</span>, alpha <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>With this scenario, the simulation can be launched without any
additional parameter.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span> <span class="co"># The seed is here to replicate the random population initialisation.</span></span>
<span><span class="va">Picea_sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_deter_forest.html">sim_deter_forest</a></span><span class="op">(</span></span>
<span>    <span class="va">Picea_for</span>,</span>
<span>    tlim <span class="op">=</span> <span class="fl">200</span>,</span>
<span>    equil_time <span class="op">=</span> <span class="fl">200</span>, equil_dist <span class="op">=</span> <span class="fl">10</span>, equil_diff <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    harvest <span class="op">=</span> <span class="st">"default"</span>, <span class="co"># this is the default value but we write it.</span></span>
<span>    SurfEch <span class="op">=</span> <span class="fl">0.03</span>,</span>
<span>    verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Starting while loop. Maximum t = 200</span></span>
<span><span class="co">#&gt; Simulation ended after time 200</span></span>
<span><span class="co">#&gt; BA stabilized at 43.98 with diff of 1.16 at time 200</span></span>
<span><span class="co">#&gt; Time difference of 1.49 secs</span></span></code></pre></div>
<p>Once the simulation is done, we can extract the basal area and the
number of individual at each step of the simulation, but also a new
variable <span class="math inline">\(H\)</span>. This is the sum of
density of harvested trees at each time step. The density of harvested
trees is also exported for each size mesh <span class="math inline">\(h_i\)</span>.</p>
<p>In this case, <span class="math inline">\(H\)</span> is correlated
with <span class="math inline">\(N\)</span> since it’s a constant
percentage not linked with a size distribution. The first step being the
initialization step, it’s normal to have no harvest.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Picea_sim</span>  <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">var</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"BAsp"</span>, <span class="st">"N"</span>, <span class="st">"H"</span><span class="op">)</span>, <span class="op">!</span> <span class="va">equil</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">var</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">.2</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span> </span></code></pre></div>
<p><img src="Harvesting_files/figure-html/sp1plot-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="modulation">Modulation<a class="anchor" aria-label="anchor" href="#modulation"></a>
</h3>
<p>This section will just illustrate variation of the default scenario.
First we modify the frequency of the harvest. When the harvest is not
triggered, the value returned is 0.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span> <span class="co"># The seed is here for initial population random functions.</span></span>
<span><span class="va">Picea_sim_f20</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_deter_forest.html">sim_deter_forest</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/forest.html">forest</a></span><span class="op">(</span>species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Picea <span class="op">=</span> <span class="va">Picea_sp</span><span class="op">)</span>, </span>
<span>                      harv_rules <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>Pmax <span class="op">=</span> <span class="fl">0.25</span>, dBAmin <span class="op">=</span> <span class="fl">3</span>, </span>
<span>                                     freq <span class="op">=</span> <span class="fl">20</span>, alpha <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    tlim <span class="op">=</span> <span class="fl">50</span>,</span>
<span>    equil_time <span class="op">=</span> <span class="fl">50</span>, equil_dist <span class="op">=</span> <span class="fl">10</span>, equil_diff <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    harvest <span class="op">=</span> <span class="st">"default"</span>, </span>
<span>    SurfEch <span class="op">=</span> <span class="fl">0.03</span>,</span>
<span>    verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Starting while loop. Maximum t = 50</span></span>
<span><span class="co">#&gt; Simulation ended after time 50</span></span>
<span><span class="co">#&gt; BA stabilized at 32.85 with diff of 0.78 at time 50</span></span>
<span><span class="co">#&gt; Time difference of 0.373 secs</span></span>
<span><span class="va">Picea_sim_f20</span>  <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">var</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"BAsp"</span>, <span class="st">"N"</span>, <span class="st">"H"</span><span class="op">)</span>, <span class="op">!</span> <span class="va">equil</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">var</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">.2</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span> </span></code></pre></div>
<p><img src="Harvesting_files/figure-html/def_freq-1.png" width="700"></p>
<p>A more advanced modification of the harvest function is ilustratted
below. Obviously, this type of modification have not been thoroughly
tested and thus is more prone to error so don’t hesitate to contact
<code>{matreex}</code> maintainer in case of trouble. For example, we
add a function where we multiply a constant rate with the mesh, meaning
that the larger the tree get, the higher the harvesting rate of its size
class.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Picea_harv</span> <span class="op">&lt;-</span> <span class="va">Picea_sp</span></span>
<span><span class="va">Picea_harv</span><span class="op">$</span><span class="va">harvest_fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">species</span>, <span class="va">...</span><span class="op">)</span><span class="op">{</span></span>
<span></span>
<span>    <span class="va">dots</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span></span>
<span>    <span class="va">ct</span> <span class="op">&lt;-</span> <span class="va">dots</span><span class="op">$</span><span class="va">ct</span></span>
<span></span>
<span>    <span class="va">rate</span> <span class="op">&lt;-</span> <span class="fl">6e-4</span> <span class="op">*</span> <span class="op">(</span><span class="va">ct</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">*</span> <span class="va">species</span><span class="op">$</span><span class="va">IPM</span><span class="op">$</span><span class="va">mesh</span> </span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">x</span> <span class="op">*</span> <span class="va">rate</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span> <span class="co"># The seed is here for initial population random functions.</span></span>
<span><span class="va">Picea_sim_f20</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_deter_forest.html">sim_deter_forest</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/forest.html">forest</a></span><span class="op">(</span>species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Picea <span class="op">=</span> <span class="va">Picea_harv</span><span class="op">)</span>, </span>
<span>                      harv_rules <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>Pmax <span class="op">=</span> <span class="fl">0.25</span>, dBAmin <span class="op">=</span> <span class="fl">3</span>, </span>
<span>                                     freq <span class="op">=</span> <span class="fl">20</span>, alpha <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    tlim <span class="op">=</span> <span class="fl">250</span>,</span>
<span>    equil_time <span class="op">=</span> <span class="fl">250</span>, equil_dist <span class="op">=</span> <span class="fl">10</span>, equil_diff <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    harvest <span class="op">=</span> <span class="st">"default"</span>,</span>
<span>    SurfEch <span class="op">=</span> <span class="fl">0.03</span>,</span>
<span>    verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Starting while loop. Maximum t = 250</span></span>
<span><span class="co">#&gt; Simulation ended after time 250</span></span>
<span><span class="co">#&gt; BA stabilized at 28.20 with diff of 5.02 at time 250</span></span>
<span><span class="co">#&gt; Time difference of 1.9 secs</span></span>
<span><span class="va">Picea_sim_f20</span>  <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">var</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"BAsp"</span>, <span class="st">"N"</span>, <span class="st">"H"</span><span class="op">)</span>, <span class="op">!</span> <span class="va">equil</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">var</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">.2</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span> </span></code></pre></div>
<p><img src="Harvesting_files/figure-html/edit_def_harv-1.png" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="uneven-scenario">Uneven scenario<a class="anchor" aria-label="anchor" href="#uneven-scenario"></a>
</h2>
<div class="section level3">
<h3 id="theory">Theory<a class="anchor" aria-label="anchor" href="#theory"></a>
</h3>
<p>Uneven-aged harvest scenario consist in harvesting trees in all size
classes with the objective to reach a stable size structure with
continuous replacing of large mature trees. This scenario depends on the
basal area of the stand and the size distribution of the tree. This
should lead to stands with uneven size distribution.</p>
<div class="section level4">
<h4 id="monospecific-case">Monospecific case<a class="anchor" aria-label="anchor" href="#monospecific-case"></a>
</h4>
<div class="section level5">
<h5 id="harvest-proportion">Harvest proportion<a class="anchor" aria-label="anchor" href="#harvest-proportion"></a>
</h5>
<p>We note <span class="math inline">\(P_{cut}\)</span> the global
harvest proportion which will determine the amount of basal area to be
cut and harvested.</p>
<p><span class="math display">\[
P_{cut} = \left\lbrace
\begin{array}{ll}
    0 &amp; if (BA_{stand} - BA_{target}) &lt; \Delta BA_{min}\\
    min(\frac{BA_{stand}-BA_{target}}{BA_{stand}}, P_{max}) &amp; if
(BA_{stand} - BA_{target}) \geq \Delta BA_{min}
\end{array}
\right\rbrace
\]</span></p>
<p>For example, some numerical values of the parameters can be <span class="math inline">\(\Delta BA_{min} = 3 m^2ha^{-1}\)</span>, <span class="math inline">\(BA_{target} = 20, 25\)</span> or <span class="math inline">\(30 m^2ha^{-1}\)</span> (depending on species) and
<span class="math inline">\(P_{max} = 0.25\)</span>.</p>
<p>Note that stand basal area <span class="math inline">\(BA_{stand}\)</span> is computed only considering
trees with a dbh above <span class="math inline">\(d_{th}\)</span> (see
below).</p>
</div>
<div class="section level5">
<h5 id="harvest-curve">Harvest curve<a class="anchor" aria-label="anchor" href="#harvest-curve"></a>
</h5>
<p>Each tree harvest probability only depends on its diameter (<span class="math inline">\(d\)</span>). There is a minimum diameter for
harvest (<span class="math inline">\(d_{th}\)</span>), harvest
probability then increases with diameter until <span class="math inline">\(d_{ha}\)</span> after which harvest probability is
constant.</p>
<p>We therefore considered the harvesting function (which associates a
dbh to an harvesting probability)</p>
<p><span class="math display">\[
h(d) = \left\lbrace
\begin{array}{ll}
    0 &amp; \text{if } d &lt; d_{th} \\
    h_{max} (\frac{d - d_{th}}{d_{ha} - d_{th}})^{k} &amp; \text{if }
d_{th}\leq d &lt; d_{ha} \\
    h_{max} &amp; \text{if } d \geq d_{ha}
\end{array}
\right\rbrace
\]</span></p>
<p>The maximum harvesting for large tree <span class="math inline">\(h_{max}\)</span> can be tuned so that the
probability for a large tree to be harvested approaches 1 after several
harvesting operations: <span class="math inline">\(h_{max} = 1 -
\sqrt[n]{1-p}\)</span> with <span class="math inline">\(n\)</span> the
number of harvesting operations. Parameter <span class="math inline">\(k\)</span> defines how quickly the harvesting rate
increase from <span class="math inline">\(d_{th}\)</span> to <span class="math inline">\(d_{ha}\)</span>.</p>
<div class="figure">
<img src="Harvesting_files/figure-html/harvest_curve_plot-1.png" alt="Harvest curve example, $d_{th} = 17.5cm$, $d_{ha}=57.5cm$, $h_{max}=0.8$, $k=2$." width="700"><p class="caption">
Harvest curve example, <span class="math inline">\(d_{th} =
17.5cm\)</span>, <span class="math inline">\(d_{ha}=57.5cm\)</span>,
<span class="math inline">\(h_{max}=0.8\)</span>, <span class="math inline">\(k=2\)</span>.
</p>
</div>
</div>
<div class="section level5">
<h5 id="harvesting-algorithm">Harvesting algorithm<a class="anchor" aria-label="anchor" href="#harvesting-algorithm"></a>
</h5>
<p>The algorithm only target tree contributing to <span class="math inline">\(BA_{stand}\)</span>, that is the trees above <span class="math inline">\(d_{th}\)</span></p>
<p>Given <span class="math inline">\(\phi(x)\)</span> the density
function of diameters, the basal area harvested is</p>
<p><span class="math display">\[
BA_{harv} = BA_{th} + BA_{ha}
\]</span> with <span class="math display">\[
BA_{ha} =  h_{max} \pi/4\int_{d_{ha}}^{d_{max}}x^2 \phi(x)dx
\]</span></p>
<p><span class="math inline">\(\bullet\)</span> If <span class="math inline">\(BA_{ha} &gt;= P_{cut} \times BA_{stand}\)</span>,
there is enough large trees (diameter above <span class="math inline">\(d_{ha}\)</span>) so that the harvest will only
concern large trees and <span class="math inline">\(BA_{th} =
0\)</span>.</p>
<p>We then find <span class="math inline">\(d_t\)</span> (with <span class="math inline">\(d_{ha} &lt; d_t &lt; d_{max}\)</span>) such that:
<span class="math display">\[  BA_{ha} = h_{max} \pi/4
\int_{d_{t}}^{d_{max}}x^2 \phi(x)dx = P_{cut} \times BA_{stand}\]</span>
Thus, the <code>{matreex}</code> package will cut the larger trees until
<span class="math inline">\(P_{cut} \times BA_{ha} - targetBA &lt;=
0\)</span>.</p>
<p><span class="math inline">\(\bullet\)</span> If <span class="math inline">\(BA_{ha} &lt; P_{cut} \times BA_{stand}\)</span>,
we first harvest <span class="math inline">\(BA_{ha}\)</span> and then
compute <span class="math inline">\(k\)</span> such as: <span class="math inline">\(BA_{th} = P_{cut} \times BA_{stand} -
BA_{ha}\)</span>. Note that</p>
</div>
</div>
<div class="section level4">
<h4 id="multispecific-case">Multispecific case<a class="anchor" aria-label="anchor" href="#multispecific-case"></a>
</h4>
<!-- #### Abundance-based preference -->
<p>As in the monospecific case, we define the global harvest rate <span class="math inline">\(P_{cut} =
\frac{BA_{harv}}{BA_{stand}}\)</span>.</p>
<p>Here, <span class="math inline">\(BA_{stand}\)</span> is divided
between <span class="math inline">\(s\)</span> species: <span class="math inline">\(BA_{stand} = \sum_{i=1}^{s} BA_{stand, i}\)</span>
and <span class="math inline">\(BA_{harv} = \sum_{i=1}^{s} BA_{harv,
i}\)</span></p>
<p>We note <span class="math inline">\(p_i = \frac{BA_{stand,
i}}{BA_{stand}}\)</span> and <span class="math inline">\(P_{cut, i} =
\frac{BA_{stand, i} - BA_{harv, i}}{BA_{stand, i}} = f(p_i) *
P_{cut}\)</span></p>
<p>We suppose that harvesting rate increases with abundance (we harvest
preferentially trees with the highest proportion), which means <span class="math inline">\(f\)</span> is an increasing function.</p>
<p>By definition,</p>
<p><span class="math display">\[
\begin{array}{ll}
BA_{harv} &amp; = \sum_{i=1}^{s} BA_{harv, i} = \sum_{i=1}^{s}
BA_{stand, i} * (1 - P_{cut, i}) \\
          &amp; = BA_{stand} \sum_{i=1}^{s} p_i * (1 - f(P_i) P_{cut})
\\
      &amp; = BA_{stand} (1 - P_{cut}) \\
\end{array}
\]</span></p>
<p>So that we have the constraint on <span class="math inline">\(f\)</span>: <span class="math inline">\(\sum_{i=1}^{s} p_i (1-f(p_i)P_{cut}) = 1 - P_{cut}
\sum_{i=1}^{s} p_i f(p_i) = 1-P_{cut}\)</span></p>
<p>which is equivalent to <span class="math inline">\(\sum_{i=1}^{s} p_i
f(p_i) = 1\)</span></p>
<p>The case <span class="math inline">\(f(p_i) = 1\)</span> works, which
leads to <span class="math inline">\(P_{cut,i} = P_{cut}\)</span>. In
that case the harvest rate is the same for every species <span class="math inline">\(i\)</span>.</p>
<p>More broadly, we can use the function <span class="math display">\[f(p_i) = \frac{p_i^{\alpha - 1}}{\sum_{i=1}^{s}
p_i ^{\alpha}}\]</span>, <span class="math inline">\(\forall \alpha &gt;
0\)</span></p>
<p>For <span class="math inline">\(\alpha = 2\)</span>, we for example
have</p>
<p><span class="math display">\[f(p_i) =\frac{p_i}{\sum_{i=1}^{s} p_i
^2} \]</span> To sum up, if<span class="math inline">\(\alpha =
1\)</span>, an abundant species will be more harvested, in effort to
reach an equi-abundance of the species. For <span class="math inline">\(\alpha &lt; 1\)</span>, the abundant species will
be less harvested. Finally, for <span class="math inline">\(\alpha &gt;
1\)</span> the most abundant species will be harvested more, in a
greater proportion than 1.</p>
<!--
#### Favoured species

In some case, we may want to favour some species compared to others.
We note $Q$ the $q$ species we want to favour, and $P_Q=\sum_{i=1}^{q} p_i$
We first compute the harvest rate $H_Q$ and $H_{1-Q}$ for respectively the favoured/other species.

If $P_Q \geq 0.5$, we take $H_Q = H_{1-Q} = H$ (the species to be favoured are already dominant).


If $P_Q < 0.5$, we compute $H_Q=f(P_Q) H$ and $H_{1-Q}=f(1-P_Q) H$ with $\alpha > 1$.
By definition, we will get $H_Q \leq H$.

We then apply for each species $i$ the harvest rate $H_i = H_Q$ or $H_i=H_{1-Q}$ depending on which group it belongs to.
-->
</div>
</div>
<div class="section level3">
<h3 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a>
</h3>
<p>All the parameters described above are input either in the
<code><a href="../reference/species.html">species()</a></code>, <code><a href="../reference/forest.html">forest()</a></code> or
<code><a href="../reference/sim_deter_forest.html">sim_deter_forest()</a></code> functions. Additional parameter
<code>dBAmin</code> is the difference between <code>BA</code> and
<code>targetBA</code> under which an harvesting will not be
triggered.</p>
<p>When plooting the result, keep in mind the difference between
<code>BAsp</code> and <code>BAstand</code>. Only the second one will
match with <code>targetBA</code>, since during uneven harvesting, trees
below <code>dth</code> are excluded from computations.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Picea_Uneven</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/species.html">species</a></span><span class="op">(</span>IPM <span class="op">=</span> <span class="va">Picea_ipm</span>, init_pop <span class="op">=</span> <span class="fu"><a href="../reference/def_initBA.html">def_initBA</a></span><span class="op">(</span><span class="fl">30</span><span class="op">)</span>, </span>
<span>                        harvest_fun <span class="op">=</span> <span class="va">Uneven_harv</span>,</span>
<span>                        harv_lim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>dth <span class="op">=</span> <span class="fl">175</span>, dha <span class="op">=</span> <span class="fl">575</span>, hmax <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Picea_for_Uneven</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/forest.html">forest</a></span><span class="op">(</span>species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Picea <span class="op">=</span> <span class="va">Picea_Uneven</span><span class="op">)</span>, </span>
<span>                      harv_rules <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>Pmax <span class="op">=</span> <span class="fl">0.25</span>, dBAmin <span class="op">=</span> <span class="fl">3</span>, </span>
<span>                                     freq <span class="op">=</span> <span class="fl">5</span>, alpha <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span> <span class="co"># The seed is here for initial population random functions.</span></span>
<span><span class="va">Picea_sim_f20</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_deter_forest.html">sim_deter_forest</a></span><span class="op">(</span></span>
<span>    <span class="va">Picea_for_Uneven</span>,</span>
<span>    tlim <span class="op">=</span> <span class="fl">260</span>,</span>
<span>    equil_time <span class="op">=</span> <span class="fl">260</span>, equil_dist <span class="op">=</span> <span class="fl">10</span>, equil_diff <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    harvest <span class="op">=</span> <span class="st">"Uneven"</span>, targetBA <span class="op">=</span> <span class="fl">20</span>, <span class="co"># We change the harvest and set targetBA.</span></span>
<span>    SurfEch <span class="op">=</span> <span class="fl">0.03</span>,</span>
<span>    verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Starting while loop. Maximum t = 260</span></span>
<span><span class="co">#&gt; Simulation ended after time 260</span></span>
<span><span class="co">#&gt; BA stabilized at 22.55 with diff of 2.89 at time 260</span></span>
<span><span class="co">#&gt; Time difference of 1.83 secs</span></span>
<span><span class="va">Picea_sim_f20</span>  <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">var</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"BAsp"</span>, <span class="st">"BAstand"</span>, <span class="st">"N"</span><span class="op">)</span>, <span class="op">!</span> <span class="va">equil</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">var</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">.2</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span> </span></code></pre></div>
<p><img src="Harvesting_files/figure-html/Uneven_sim-1.png" width="700"></p>
<p>We notice that the basal area obtained by the simulation is higher
than the targeted one. This can be explained by the fact that the
cutting calculation is done on <span class="math inline">\(BA_{stand}\)</span>, which does not take into
account individuals smaller than <span class="math inline">\(d_{th}\)</span>.</p>
</div>
</div>
<div class="section level2">
<h2 id="even-scenario">Even scenario<a class="anchor" aria-label="anchor" href="#even-scenario"></a>
</h2>
<!-- $$ -->
<!-- dg = \sqrt{\frac{\sum_{i = 0}^n d_i^2 x_i}{ \sum_{i = 0}^n x_i }} \\ -->
<!-- dg_{cut} = \sqrt{\frac{\sum_{i = 0}^n d_i^2 x_i Pc_i }{ \sum_{i = 0}^n x_i Pc_i }} -->
<!-- $$ -->
<!-- mesh in cm. -->
<!-- $$ -->
<!-- RDI = \frac{ \sum_{i = 0}^n x_i }{ e^{ RDI_{int} + RDI_{slope} \times \frac{ \log( \frac{ \sum_{i = 0}^n mesh_i^2  x_i }{ \sum_{i = 0}^n x_i} ) }{2}   } } -->
<!-- $$ -->
<p>The objective of even harvesting is to grow trees with the same age
until they reach a self-thinning boundary and cut all of them at this
stage. This self-thinning boundary is given for each species following
:</p>
<p><span class="math display">\[N_{max} = e^{intercept+slope \cdot
log(Dg)}\]</span> The species parameters are given in <span class="citation">Aussenac et al. (<a href="#ref-Aussenac2021" role="doc-biblioref">2021</a>)</span> and inside the package with
<code>rdi_coef</code> table. <span class="math inline">\(Dg\)</span> is
the mean quadratic diameter of trees.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">rdi_coef</span><span class="op">)</span></span>
<span><span class="va">rdi_coef</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/drop.html" class="external-link">drop</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span></span>
<span>    <span class="va">rdi_coef</span><span class="op">[</span><span class="va">rdi_coef</span><span class="op">$</span><span class="va">species</span> <span class="op">==</span> <span class="st">"Picea_abies"</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"intercept"</span>, <span class="st">"slope"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">rdi_coef</span></span>
<span><span class="co">#&gt; intercept     slope </span></span>
<span><span class="co">#&gt; 12.875790 -1.762061</span></span></code></pre></div>
<p>From this, we can compute the density index <span class="math inline">\(DI = N / N_{max}\)</span> with <span class="math inline">\(N\)</span> the number of stems.</p>
<p>During the growth process, trees below the mean quadratic diameter
<span class="math inline">\(Dg\)</span> are cut. The magnitude of this
cut is given with <span class="math inline">\(Kg\)</span>, the ratio
between the mean quadratic diameter of killed trees <span class="math inline">\(Dg_d\)</span> and the mean quadratic diameter
<span class="math inline">\(Dg\)</span> :</p>
<p><span class="math display">\[Kg = Dg^2_d / Dg^2\]</span></p>
<p>The algorithm present in <code>Even_harv</code> is triggered if <span class="math inline">\(DI &gt; targetRDI\)</span> and optimise two
parameters <span class="math inline">\(h_{max}\)</span> and <span class="math inline">\(k\)</span> for a cut probability curve to reach
<span class="math inline">\(targetKg\)</span> and <span class="math inline">\(targetRDI\)</span>.</p>
<p><span class="math display">\[Pcut_i = hmax * i^{-k}\]</span></p>
<div class="figure">
<img src="Harvesting_files/figure-html/even_hcurve_plot-1.png" alt="Harvest curve example with various combination of hmax and k" width="700"><p class="caption">
Harvest curve example with various combination of hmax and k
</p>
</div>
<p>The last parameter for an even harvested simulation is the final cut
time. The stand will be harvested with the previous rules at a given
frequency but at a certain point, the manager will harvest all trees and
plant new ones. This time is dependant on the species growth and
differents targets. The value is named <code>final_harv</code> in
<code><a href="../reference/sim_deter_forest.html">sim_deter_forest()</a></code> function.</p>
<p><strong>Because the rdi coefficient depends on a species, it’s not
possible to use multiple species forest with {matreex} package. Please
contact authors if you need to use mutlispecific even
harvesting.</strong></p>
<!-- Mortality is triggered when stand density exceeds the self-thinning boundary, i.e. when $DI$  is greater than or equal to 1. In that case, $DI$ is reduced to 1 using the $Kg$ parameter, with -->
<!-- To reduce $DI$ to 1, the number of trees in the stand is reduced while the mean quadratic diameter is increased, which amounts to preferentially killing small trees. In mixed stands, the number of trees killed for each species is defined according to their proportion in the stand before mortality process. -->
<div class="section level3">
<h3 id="examples-1">Examples<a class="anchor" aria-label="anchor" href="#examples-1"></a>
</h3>
<p>The rdi parameters are input in the <code><a href="../reference/species.html">species()</a></code> function.
Calling <code><a href="../reference/forest.html">forest()</a></code> function is not different, only the
frequency of harvest will be used. The different targets
<code>targetKg</code>, <code>targetRDI</code> and
<code>final_harv</code> values are set when launching a simulation.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Picea_Even</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/species.html">species</a></span><span class="op">(</span></span>
<span>    IPM <span class="op">=</span> <span class="va">Picea_ipm</span>, init_pop <span class="op">=</span> <span class="va">def_init_even</span>,</span>
<span>    harvest_fun <span class="op">=</span> <span class="va">Even_harv</span>, rdi_coef <span class="op">=</span> <span class="va">rdi_coef</span>,</span>
<span>    harv_lim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>dth <span class="op">=</span> <span class="fl">175</span>, dha <span class="op">=</span> <span class="fl">575</span>, hmax <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">Picea_for_Even</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/forest.html">forest</a></span><span class="op">(</span>species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Picea <span class="op">=</span> <span class="va">Picea_Even</span><span class="op">)</span>,</span>
<span>                      harv_rules <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>Pmax <span class="op">=</span> <span class="fl">0.25</span>, dBAmin <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                                     freq <span class="op">=</span> <span class="fl">5</span>, alpha <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span> <span class="co"># The seed is here for initial population random functions.</span></span>
<span><span class="va">Picea_sim_f20</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_deter_forest.html">sim_deter_forest</a></span><span class="op">(</span></span>
<span>    <span class="va">Picea_for_Even</span>,</span>
<span>    tlim <span class="op">=</span> <span class="fl">100</span>,</span>
<span>    equil_time <span class="op">=</span> <span class="fl">100</span>, equil_dist <span class="op">=</span> <span class="fl">10</span>, equil_diff <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    harvest <span class="op">=</span> <span class="st">"Even"</span>, targetRDI <span class="op">=</span> <span class="fl">0.9</span>, targetKg <span class="op">=</span> <span class="fl">0.6</span>,</span>
<span>    final_harv <span class="op">=</span> <span class="fl">80</span>,</span>
<span>    SurfEch <span class="op">=</span> <span class="fl">0.03</span>,</span>
<span>    verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Starting while loop. Maximum t = 100</span></span>
<span><span class="co">#&gt; Simulation ended after time 100</span></span>
<span><span class="co">#&gt; BA stabilized at 4.20 with diff of 2.36 at time 100</span></span>
<span><span class="co">#&gt; Time difference of 0.697 secs</span></span>
<span><span class="va">Picea_sim_f20</span>  <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">var</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"BAsp"</span>, <span class="st">"N"</span>, <span class="st">"H"</span><span class="op">)</span>, <span class="op">!</span> <span class="va">equil</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">var</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">.2</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span></span></code></pre></div>
<p><img src="Harvesting_files/figure-html/Even_sim-1.png" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Aussenac2021" class="csl-entry">
Aussenac, R, T Pérot, M Fortin, F de Coligny, JM Monnet, and P Vallet.
2021. <span>“The Salem Simulator Version 2.0: A Tool for Predicting the
Productivity of Pure and Mixed Forest Stands and Simulating Management
Operations [Version 2; Peer Review: 2 Approved].”</span> <em>Open
Research Europe</em> 1 (61). <a href="https://doi.org/10.12688/openreseurope.13671.2" class="external-link">https://doi.org/10.12688/openreseurope.13671.2</a>.
</div>
<div id="ref-kunstler2021" class="csl-entry">
Kunstler, Georges, Arnaud Guyennon, Sophia Ratcliffe, Nadja Rüger,
Paloma Ruiz-Benito, Dylan Z. Childs, Jonas Dahlgren, et al. 2021.
<span>“Demographic Performance of European Tree Species at Their Hot and
Cold Climatic Edges.”</span> <em>Journal of Ecology</em> 109 (2):
1041–54. <a href="https://doi.org/10.1111/1365-2745.13533" class="external-link">https://doi.org/10.1111/1365-2745.13533</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://gowachin.github.io/" class="external-link">Maxime Jaunatre</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
