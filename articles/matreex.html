<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="matreex">
<title>Basic functions and examples • matreex</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Basic functions and examples">
<meta property="og:description" content="matreex">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">matreex</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/matreex.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Harvesting.html">Harvesting models</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/gowachin/matreex" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Basic functions and examples</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/gowachin/matreexvignettes/matreex.Rmd" class="external-link"><code>vignettes/matreex.Rmd</code></a></small>
      <div class="d-none name"><code>matreex.Rmd</code></div>
    </div>

    
    
<style>
body {
text-align: justify}
</style>
<p>This vignette illustrates the basic functions used to run simulations
projecting the population of size-structured trees with
<code>{matreex}</code> package. The package can model the dynamic of
monospecific or plurispecific tree communities. Different modules allow
also to simulate harvesting and disturbances. To project forward the
dynamic of size-structured tree populations, this package relies on
<strong>integrated projection models</strong> (later named IPM).</p>
<div class="section level2">
<h2 id="rapid-description-of-the-integral-projection-model">Rapid description of the Integral Projection Model<a class="anchor" aria-label="anchor" href="#rapid-description-of-the-integral-projection-model"></a>
</h2>
<p>Details on the fitting and the integration of IPM model can be found
in <span class="citation">Ellner, Childs, and Rees (<a href="#ref-ellner2016" role="doc-biblioref">2016</a>)</span>. Briefly,
an IPM predicts the size distribution, <span class="math inline">\(n(z', t+1)\)</span>, of a population at time
t+1 from its size distribution at time t, <span class="math inline">\(n(z, t)\)</span>, with <span class="math inline">\(z\)</span> the size at t and <span class="math inline">\(z'\)</span> the size at <span class="math inline">\(t + 1\)</span>, based on the following equation
(<span class="citation">Ellner, Childs, and Rees (<a href="#ref-ellner2016" role="doc-biblioref">2016</a>)</span>):</p>
<p><span class="math display">\[
n(z', t+1) = \int_{L}^{U} K(z', z) n(z, t) dz
\]</span></p>
<p>with <span class="math inline">\(L\)</span> and <span class="math inline">\(U\)</span> being, respectively, the lower and
upper observed sizes for integration of the kernel <span class="math inline">\(K\)</span>.</p>
<p>The kernel <span class="math inline">\(K(z' ,z)\)</span> can be
split into the survival and growth kernel <span class="math inline">\(P(z' ,z)\)</span> and the fecundity kernel
<span class="math inline">\(F(z', z)\)</span>, as follows : <span class="math inline">\(K(z' ,z) = P(z' ,z) + F(z'
,z)\)</span> .</p>
<p>The fecundity kernel <span class="math inline">\(F(z',
z)\)</span> gives the size distribution of newly recruited trees at time
<span class="math inline">\(t+1\)</span> as a function of the size
distribution at time t. The survival and growth kernel <span class="math inline">\(P(z', z)\)</span> is defined as <span class="math inline">\(P(z', z) = s(z) \times G(z', z)\)</span>,
<span class="math inline">\(s\)</span> being the survival function and
<span class="math inline">\(G\)</span> the growth function. The kernel
<span class="math inline">\(K(z' ,z)\)</span>, thus, integrate the
three key vital rates functions: growth, survival, and recruitment. The
kernel <span class="math inline">\(P\)</span> is numerically
approximated with a big iteration matrix and the continuous size
distribution <span class="math inline">\(n\)</span> is approximated by a
big state vector. The dimension and the width of the size class are
selected to ensure a good numerical integration of the kernel <span class="math inline">\(P\)</span>. Details on the numerical integration
are given below and in <span class="citation">Kunstler et al. (<a href="#ref-kunstler2021" role="doc-biblioref">2021</a>)</span> and <span class="citation">Guyennon et al. (<a href="#ref-guyennon2023" role="doc-biblioref">2023</a>)</span> .
<!--The figure 1 presents the structure and approach of the IPM. -->
Note, that this package do not cover the statistical fitting of the
vital rates functions.</p>
</div>
<div class="section level2">
<h2 id="simulations-input">Simulations input<a class="anchor" aria-label="anchor" href="#simulations-input"></a>
</h2>
<div class="section level3">
<h3 id="define-a-species">Define a species<a class="anchor" aria-label="anchor" href="#define-a-species"></a>
</h3>
<p>Before simulating forest, we need first to define tree species in R.
Species regroups basic vital rates functions: growth, recruitment and
survival. In this package, we provide the fitted vital rates functions
used in <span class="citation">Kunstler et al. (<a href="#ref-kunstler2021" role="doc-biblioref">2021</a>)</span> and <span class="citation">Guyennon et al. (<a href="#ref-guyennon2023" role="doc-biblioref">2023</a>)</span> . These functions depend on tree
size, local competition based on the sum of basal area of competitors,
and two climatic variables. The climatic variables are the sum of the
sum of growing degree days <em>sgdd</em>, the water aridity index
<em>wai</em> (see <span class="citation">Kunstler et al. (<a href="#ref-kunstler2021" role="doc-biblioref">2021</a>)</span> for more
details). <span class="citation">Kunstler et al. (<a href="#ref-kunstler2021" role="doc-biblioref">2021</a>)</span> and <span class="citation">Guyennon et al. (<a href="#ref-guyennon2023" role="doc-biblioref">2023</a>)</span> used a resampling procedure to
estimate the vital rates functions resulting in 100 resampled estimate
of the parameters of each functions, here to simplify the simulations we
provide only the averaged parameters over those 100 resamples. It is
however, in theory, possible to run simulations with other vital rates
functions if they are provided as glm objects (please contact the
authors to test new variables).</p>
<p>To build an IPM for a species we start from fitted function <span class="citation">Kunstler et al. (<a href="#ref-kunstler2021" role="doc-biblioref">2021</a>)</span> and <span class="citation">Guyennon et al. (<a href="#ref-guyennon2023" role="doc-biblioref">2023</a>)</span> . To do the numerical integration
of <span class="math inline">\(P\)</span>, we need to define the mesh
dimension, here <span class="math inline">\(700\)</span>, the lower
<span class="math inline">\(L\)</span> and upper limits <span class="math inline">\(U\)</span>, here respectively 90mm and
<code>get_maxdbh(fit_Picea_abies) * 1.1</code> = 1204.5mm, and range of
value of competition index BA (here from 0 to 60 <span class="math inline">\(m^2/ha\)</span>). These are the values used in
<span class="citation">Kunstler et al. (<a href="#ref-kunstler2021" role="doc-biblioref">2021</a>)</span> and <span class="citation">Guyennon et al. (<a href="#ref-guyennon2023" role="doc-biblioref">2023</a>)</span> that were optimized to provide
good numerical integration.</p>
<p><strong>Please keep in mind this computation is intensive and may
take few minutes!</strong></p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">matreex</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load fitted model for a species</span></span>
<span><span class="co"># fit_species # list of all species in dataset</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"fit_Picea_abies"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load associated climate</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"climate_species"</span><span class="op">)</span></span>
<span><span class="va">climate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">climate_species</span>, <span class="va">N</span> <span class="op">==</span> <span class="fl">2</span> <span class="op">&amp;</span> <span class="va">sp</span> <span class="op">==</span> <span class="st">"Picea_abies"</span>, select <span class="op">=</span> <span class="op">-</span><span class="va">sp</span><span class="op">)</span></span>
<span><span class="co"># N here is a climate defined in Kunstler et al 2021. </span></span>
<span><span class="co"># N == 2 is the optimum climate for the species. </span></span>
<span><span class="co"># see ?climate_species for more info.</span></span>
<span><span class="va">climate</span></span>
<span><span class="co">#&gt;        sgdd       wai        sgddb      waib      wai2   sgdd2      PC1</span></span>
<span><span class="co">#&gt; 62 1444.667 0.4519387 0.0006922012 0.6887343 0.2042486 2087062 1.671498</span></span>
<span><span class="co">#&gt;           PC2 N       SDM</span></span>
<span><span class="co">#&gt; 62 0.02602064 2 0.6760556</span></span>
<span></span>
<span><span class="va">Picea_ipm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_IPM.html">make_IPM</a></span><span class="op">(</span></span>
<span>    species <span class="op">=</span> <span class="st">"Picea_abies"</span>, </span>
<span>    climate <span class="op">=</span> <span class="va">climate</span>, </span>
<span>    fit <span class="op">=</span> <span class="va">fit_Picea_abies</span>,</span>
<span>    clim_lab <span class="op">=</span> <span class="st">"optimum clim"</span>, </span>
<span>    mesh <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>m <span class="op">=</span> <span class="fl">700</span>, L <span class="op">=</span> <span class="fl">90</span>, U <span class="op">=</span> <span class="fu"><a href="../reference/get_maxdbh.html">get_maxdbh</a></span><span class="op">(</span><span class="va">fit_Picea_abies</span><span class="op">)</span> <span class="op">*</span> <span class="fl">1.1</span><span class="op">)</span>,</span>
<span>    BA <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">60</span>, <span class="co"># Default values are 0:200, smaller values speed up this vignette.</span></span>
<span>    verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Launching integration loop</span></span>
<span><span class="co">#&gt; GL integration occur on 32 cells</span></span>
<span><span class="co">#&gt; midbin integration occur on 25 cells</span></span>
<span><span class="co">#&gt; Loop done.</span></span>
<span><span class="co">#&gt; Time difference of 50.5 secs</span></span></code></pre></div>
<p>Once the IPM is integrated on a BA range, we can use it to build a
species object. In R, a species is a list object that is constructed
with the <code><a href="../reference/species.html">species()</a></code> function. In addition to the IPM kernel
<span class="math inline">\(P\)</span>, this list require few more
functions to work during simulations :</p>
<ul>
<li><p><code>init_pop</code> : Function to draw the initial size
distribution. The default one draw distribution for a basal area (later
named BA) of 1 <span class="math inline">\(m^2/ha\)</span> with random
functions (see the help of the function for more details). The package
provide other functions to draw random distribution at a selected BA
(<code><a href="../reference/def_initBA.html">def_initBA()</a></code>) or a given distribution
(<code><a href="../reference/def_init_k.html">def_init_k()</a></code>).</p></li>
<li><p><code>harvest_fun</code> : Function that cut tree given the size
distribution. The default function cut 0.6% per year of the trees
regardless of their size. Further functions allow to harvest according
to Uneven and Even rules (see Harvesting Vignette).</p></li>
<li><p><code>disturb_fun</code> : Function that return tree mortality
after a disturbance. The default is no disturbance.</p></li>
</ul>
<p>A species also comes with few parameters, but they are only used for
harvest and disturbance modules.</p>
<p>For this example, we will just modify the initial size distribution
to start at a basal area of 30 <span class="math inline">\(m^2/ha\)</span>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Picea_sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/species.html">species</a></span><span class="op">(</span>IPM <span class="op">=</span> <span class="va">Picea_ipm</span>, init_pop <span class="op">=</span> <span class="fu"><a href="../reference/def_initBA.html">def_initBA</a></span><span class="op">(</span><span class="fl">30</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="define-a-forest">Define a forest<a class="anchor" aria-label="anchor" href="#define-a-forest"></a>
</h3>
<p>Once each species objects are built, we can assemble them in a
<code>forest</code> object. This function also require additional
parameters, but they are only used for harvest and disturbance
modules.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Picea_for</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/forest.html">forest</a></span><span class="op">(</span>species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Picea <span class="op">=</span> <span class="va">Picea_sp</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="running-simulations">Running simulations<a class="anchor" aria-label="anchor" href="#running-simulations"></a>
</h2>
<p>A simulations project forward a size-structured population from its
initial state with the matrix kernel <span class="math inline">\(P\)</span> and the recruitment function. This
function requires the length of the simulation and the time limit to
search for an equilibrium. A simulation is run until the time limit is
reached and can continue further if an equilibrium is not reached.
Another parameter is the simulated surface <code>SurfEch</code>, it’s
define the surface of the studied forest. This parameter is mainly here
for historical purpose as models were fitted on <span class="math inline">\(300m^2\)</span> plot, and output is scaled to one
hectare.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span> <span class="co"># The seed is here for initial population random functions.</span></span>
<span><span class="va">Picea_sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_deter_forest.html">sim_deter_forest</a></span><span class="op">(</span></span>
<span>    <span class="va">Picea_for</span>, </span>
<span>    tlim <span class="op">=</span> <span class="fl">200</span>, </span>
<span>    equil_time <span class="op">=</span> <span class="fl">300</span>, equil_dist <span class="op">=</span> <span class="fl">50</span>, equil_diff <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    SurfEch <span class="op">=</span> <span class="fl">0.03</span>,</span>
<span>    verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Starting while loop. Maximum t = 300</span></span>
<span><span class="co">#&gt; Simulation ended after time 263</span></span>
<span><span class="co">#&gt; BA stabilized at 45.43 with diff of 0.94 at time 263</span></span>
<span><span class="co">#&gt; Time difference of 2.03 secs</span></span></code></pre></div>
<p>In the code above, we simulate for 200 years (<code>tlim</code>)
years and past this time we continue the simulation till it reach an
equilibrium up to 300 years (see figure A). After <code>tlim</code>, the
simulation will continue until the population reach an equilibrium up to
a maximum of 300 year (<code>equil_time</code>) .</p>
<p>The criteria for reaching an equilibrium (in green) is based on
computing the range of variation of BA for a moving window of length
<code>equil_dist</code> since the current step (in grey). The
equilibrium is reached if the range of variation within this moving
window is less than <code>equil_diff</code>. The equilibrium is reached
at the first timestep for which the basal area range is lower than
<code>equil_diff</code>. The steps between <code>tlim</code> and
<code>t_equil</code> are not recorded. The search for the equilibrium
start at <code>tlim</code> over the last <code>equil_dist</code> steps
(see figure B). This is why <code>equil_dist</code> must not be higher
than <code>tlim</code>. If we want to register the full dynamic, we can
set <code>tlim = equil_time</code> (see figure C). <strong>The
equilibrium is always the last size distribution</strong> (shown in
green in figure). Note that in this case, the final distribution will be
returned in the result twice. The <code>equil_dist</code> and
<code>equil_diff</code> parameters are not important in this case.</p>
<p><img src="matreex_files/figure-html/timeline_explain-1.png" width="700"></p>
<p>Keep in mind that despite high <code>tlim</code> and
<code>equil_time</code> values, the equilibrium may not be reached at
the end of the simulation. There is currently no way in the algorithm to
report this to the user. The best way to detect “false equilibrium” is
when the last step takes place at <code>t == equil_time</code> and by
plotting the basal area along time. These cases are illustrated in
figure D and E.</p>
<p>Also, this equilibrium is only computed on total basal area, and the
distribution can change. We welcome any suggestions you may have
regarding the equilibrium definition.</p>
<p><img src="matreex_files/figure-html/timeline_explain_no_eq-1.png" width="700"></p>
<p>The output of a simulation is a data.frame in long format (according
to tidyverse style). This is very helpful to filter the output and plot
it with <a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a>. Variables exported are the basal area
per species <code>BAsp</code>, <code>n</code> and <code>h</code>the
number of alive and harvested individuals per mesh, and <code>N</code>
and <code>H</code> the total number of alive and harvested individuals
in the forest (per hectar).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Picea_sim</span>  <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">var</span> <span class="op">==</span> <span class="st">"BAsp"</span>, <span class="op">!</span> <span class="va">equil</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">.4</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"BA"</span><span class="op">)</span></span></code></pre></div>
<p><img src="matreex_files/figure-html/sp1plot-1.png" width="700"></p>
<p>If size distributions needs to be extracted, it can be easily done
with <a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a> functions. The equilibrium step is associated
with a logical variable to extract it.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">Picea_sim</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 7</span></span></span>
<span><span class="co">#&gt;   species     var    time  mesh  size equil value</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Picea_abies n         1     1     0 FALSE  0   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Picea_abies n         2     1     0 FALSE  2.19</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Picea_abies n         3     1     0 FALSE  2.18</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Picea_abies n         4     1     0 FALSE  2.21</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> Picea_abies n         5     1     0 FALSE  2.26</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> Picea_abies n         6     1     0 FALSE  2.28</span></span>
<span></span>
<span><span class="co"># get the maximum time</span></span>
<span><span class="va">max_t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">Picea_sim</span><span class="op">$</span><span class="va">time</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Filter example to extract the size distribution</span></span>
<span><span class="va">Picea_sim</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"m"</span>, <span class="va">var</span><span class="op">)</span>, <span class="va">time</span> <span class="op">==</span> <span class="va">max_t</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">size</span>, <span class="va">value</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 0 × 2</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2 variables: size &lt;dbl&gt;, value &lt;dbl&gt;</span></span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="customizing-the-simulations">Customizing the simulations<a class="anchor" aria-label="anchor" href="#customizing-the-simulations"></a>
</h2>
<p>The above simulation is one of the simplest we can produce with this
package. This chapter will describe some basic customization we can add
before running a simulation.</p>
<div class="section level3">
<h3 id="initialisation-step">Initialisation step<a class="anchor" aria-label="anchor" href="#initialisation-step"></a>
</h3>
<p>By default, the initialization of the population run random process
to draw a size distribution for each species. We already show a function
(<code><a href="../reference/def_initBA.html">def_initBA()</a></code>) that scale this distribution to a given
basal area. However, for a basal area value, multiple distribution are
possible. To control the exact distribution at start, we use
<code><a href="../reference/def_init_k.html">def_init_k()</a></code>. This choice of starting distribution can be
used to reproduce simulations, starting from an equilibrium or a post
disturbance state.</p>
<p>Here is an example where we start from <span class="math inline">\(t
= 150\)</span> of the previous simulation. This will illustrate that
despite the simulation said it reached equilibrium at time <span class="math inline">\(t =\)</span> 263244, our parameters have
introduced failed to identify the true equilibrium. The previous
equilibrium is highlighted in blue rectangle.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># extract distribution</span></span>
<span><span class="va">distrib_t150</span> <span class="op">&lt;-</span> <span class="va">Picea_sim</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">var</span> <span class="op">==</span> <span class="st">"n"</span>, <span class="va">time</span> <span class="op">==</span> <span class="fl">150</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span></span>
<span><span class="co"># NOTE : this distribution is given per ha and we need it for SurfEch = 0.03.</span></span>
<span><span class="va">distrib_t150</span> <span class="op">&lt;-</span> <span class="va">distrib_t150</span> <span class="op">*</span> <span class="fl">0.03</span></span>
<span></span>
<span><span class="va">Picea_sp</span><span class="op">$</span><span class="va">init_pop</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/def_init_k.html">def_init_k</a></span><span class="op">(</span><span class="va">distrib_t150</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Picea_sim_k</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_deter_forest.html">sim_deter_forest</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/forest.html">forest</a></span><span class="op">(</span>species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Picea <span class="op">=</span> <span class="va">Picea_sp</span><span class="op">)</span><span class="op">)</span>, </span>
<span>    tlim <span class="op">=</span> <span class="fl">200</span>, </span>
<span>    equil_time <span class="op">=</span> <span class="fl">300</span>, equil_dist <span class="op">=</span> <span class="fl">50</span>,</span>
<span>    SurfEch <span class="op">=</span> <span class="fl">0.03</span>,</span>
<span>    verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Starting while loop. Maximum t = 300</span></span>
<span><span class="co">#&gt; Simulation ended after time 300</span></span>
<span><span class="co">#&gt; BA stabilized at 30.32 with diff of 1.25 at time 300</span></span>
<span><span class="co">#&gt; Time difference of 2.32 secs</span></span>
<span></span>
<span><span class="va">Picea_sim_k</span>  <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">var</span> <span class="op">==</span> <span class="st">"BAsp"</span>, <span class="op">!</span> <span class="va">equil</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="co"># below, we keep the time reference of the previous simulation </span></span>
<span>    <span class="co"># to simplify the understanding of the full document.</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>time <span class="op">=</span> <span class="va">time</span> <span class="op">+</span> <span class="fl">150</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">.4</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"BA"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_rect</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>xmin <span class="op">=</span> <span class="va">prev_equil</span> <span class="op">-</span> <span class="fl">50</span>, xmax <span class="op">=</span> <span class="va">prev_equil</span>, </span>
<span>                                     ymin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">value</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>, ymax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                       alpha <span class="op">=</span> <span class="fl">0.002</span>, fill <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="st">"False equilibrium"</span>, </span>
<span>                  x <span class="op">=</span> <span class="va">prev_equil</span> <span class="op">-</span> <span class="fl">25</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span> <span class="op">-</span> <span class="fl">3</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> </span></code></pre></div>
<p><img src="matreex_files/figure-html/sp1initk-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="recruitment-delay">Recruitment delay<a class="anchor" aria-label="anchor" href="#recruitment-delay"></a>
</h3>
<p>New trees are recruited at <span class="math inline">\(L\)</span>
(90mm). Trees takes however several years to grow from seed to the
minimum size <span class="math inline">\(L\)</span>. To represents the
time lag for a tree to recruit up to <span class="math inline">\(L\)</span>, we can modify a species by adding a
delay for recruitment of new individuals. By default, the recruitment is
a given number of new individuals. This number is split in half and adds
to the first two class of size distribution. Adding delay expand the IPM
with <code>n_delay</code> age based classes to represent the year its
takes (here 5 years) to grow up to <span class="math inline">\(L\)</span>. The new recruit will age from one age
class to another until they enter the size-based IPM.</p>
<p>A default delay is used by <code>build_IPM()</code> for each species.
These values are computed from regressions.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n_delay</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span><span class="va">Picea_sp_d5</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/delay.html">delay</a></span><span class="op">(</span><span class="va">Picea_sp</span>, <span class="va">n_delay</span><span class="op">)</span></span>
<span><span class="va">Picea_sp_d5</span><span class="op">$</span><span class="va">info</span><span class="op">[</span><span class="st">"species"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Picea_delayed"</span> <span class="co"># We rename the species for easier plot.</span></span>
<span><span class="va">Picea_sp_d5</span><span class="op">$</span><span class="va">init_pop</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/def_initBA.html">def_initBA</a></span><span class="op">(</span><span class="fl">30</span><span class="op">)</span></span></code></pre></div>
<p>The simulation is run in the same way as the delay is only defined at
the IPM level.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span><span class="va">Picea_sim_d5</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_deter_forest.html">sim_deter_forest</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/forest.html">forest</a></span><span class="op">(</span>species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Picea <span class="op">=</span> <span class="va">Picea_sp_d5</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    tlim <span class="op">=</span> <span class="fl">200</span>, </span>
<span>    equil_time <span class="op">=</span> <span class="fl">200</span>, equil_dist <span class="op">=</span> <span class="fl">50</span>,</span>
<span>    SurfEch <span class="op">=</span> <span class="fl">0.03</span>,</span>
<span>    verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Starting while loop. Maximum t = 200</span></span>
<span><span class="co">#&gt; Simulation ended after time 200</span></span>
<span><span class="co">#&gt; BA stabilized at 43.85 with diff of 10.04 at time 200</span></span>
<span><span class="co">#&gt; Time difference of 1.46 secs</span></span></code></pre></div>
<p>Equilibrium BA should be really close with or without delay (<span class="math inline">\(\Delta_{BA} &lt; 1\)</span>). N is expected to
increase with delay since delayed mesh cell with seeds are counted
in.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Picea_sim_d5</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">Picea_sim</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">var</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"BAsp"</span>, <span class="st">"N"</span><span class="op">)</span>, <span class="op">!</span><span class="va">equil</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">species</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>linetype <span class="op">=</span> <span class="st">"dashed"</span>, linewidth <span class="op">=</span> <span class="fl">.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">.7</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"BA"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">var</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="cn">NULL</span></span></code></pre></div>
<p><img src="matreex_files/figure-html/delay_plot-1.png" width="700"></p>
<!-- Despite a really close BA, the size distribution is different at equilibrium. -->
<!-- *Note : Values below the redline does not count in BA computation.* -->
</div>
<div class="section level3">
<h3 id="multiple-species">Multiple species<a class="anchor" aria-label="anchor" href="#multiple-species"></a>
</h3>
<p>Multi-specific simulations are performed like the simulations
previously illustrated. The only difference is in the construction of
the forest object. This explain why the <code>species</code> argument
for <code><a href="../reference/forest.html">forest()</a></code> function require a list for input.</p>
<p>We need to modelise a second species. Be careful to select the same
climate as the first species.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"fit_Abies_alba"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Abies_ipm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_IPM.html">make_IPM</a></span><span class="op">(</span></span>
<span>    species <span class="op">=</span> <span class="st">"Abies_alba"</span>, </span>
<span>    climate <span class="op">=</span> <span class="va">climate</span>, <span class="co"># this variable is defined at the top of the doc.</span></span>
<span>    fit <span class="op">=</span> <span class="va">fit_Abies_alba</span>,</span>
<span>    clim_lab <span class="op">=</span> <span class="st">"optimum clim"</span>,</span>
<span>    mesh <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>m <span class="op">=</span> <span class="fl">700</span>, L <span class="op">=</span> <span class="fl">90</span>, U <span class="op">=</span> <span class="fu"><a href="../reference/get_maxdbh.html">get_maxdbh</a></span><span class="op">(</span><span class="va">fit_Abies_alba</span><span class="op">)</span> <span class="op">*</span> <span class="fl">1.1</span><span class="op">)</span>,</span>
<span>    BA <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">60</span>, <span class="co"># Default values are 0:200, smaller values speed up this vignette.</span></span>
<span>    verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Launching integration loop</span></span>
<span><span class="co">#&gt; GL integration occur on 24 cells</span></span>
<span><span class="co">#&gt; midbin integration occur on 25 cells</span></span>
<span><span class="co">#&gt; Loop done.</span></span>
<span><span class="co">#&gt; Time difference of 33.3 secs</span></span>
<span><span class="va">Abies_sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/species.html">species</a></span><span class="op">(</span>IPM <span class="op">=</span> <span class="va">Abies_ipm</span>, init_pop <span class="op">=</span> <span class="fu"><a href="../reference/def_initBA.html">def_initBA</a></span><span class="op">(</span><span class="fl">35</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># We edit back the init_fun for Picea</span></span>
<span><span class="va">Picea_sp</span><span class="op">$</span><span class="va">init_pop</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/def_initBA.html">def_initBA</a></span><span class="op">(</span><span class="fl">15</span><span class="op">)</span></span>
<span><span class="va">Picea_Abies_for</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/forest.html">forest</a></span><span class="op">(</span>species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Picea <span class="op">=</span> <span class="va">Picea_sp</span>, Abies <span class="op">=</span> <span class="va">Abies_sp</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span><span class="va">Picea_Abies_sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_deter_forest.html">sim_deter_forest</a></span><span class="op">(</span></span>
<span>    <span class="va">Picea_Abies_for</span>, </span>
<span>    tlim <span class="op">=</span> <span class="fl">500</span>, </span>
<span>    equil_time <span class="op">=</span> <span class="fl">500</span>, equil_dist <span class="op">=</span> <span class="fl">50</span>,</span>
<span>    SurfEch <span class="op">=</span> <span class="fl">0.03</span>,</span>
<span>    verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Starting while loop. Maximum t = 500</span></span>
<span><span class="co">#&gt; time 500 | BA diff : 0.54</span></span>
<span><span class="co">#&gt; Simulation ended after time 500</span></span>
<span><span class="co">#&gt; BA stabilized at 50.15 with diff of 0.54 at time 500</span></span>
<span><span class="co">#&gt; Time difference of 5.99 secs</span></span>
<span></span>
<span><span class="va">Picea_Abies_sim</span>  <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">var</span> <span class="op">==</span> <span class="st">"BAsp"</span>, <span class="op">!</span> <span class="va">equil</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">species</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">.4</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"BA"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_summary.html" class="external-link">stat_summary</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="st">"sum"</span>,  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"Total"</span><span class="op">)</span>,</span>
<span>                 geom <span class="op">=</span><span class="st">'line'</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, linewidth <span class="op">=</span> <span class="fl">.3</span><span class="op">)</span></span></code></pre></div>
<p><img src="matreex_files/figure-html/nsp_forest-1.png" width="700"></p>
<p>An important point to note for multiple species is that the
equilibrium is defined at the forest level, that is the sum of species
basal area.</p>
<p><img src="matreex_files/figure-html/nsp_timeline-1.png" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-ellner2016" class="csl-entry">
Ellner, Stephen P., Dylan Z. Childs, and Mark Rees. 2016.
<em>Data-Driven <span>Modelling</span> of <span>Structured</span>
<span>Populations</span>: <span>A</span> <span>Practical</span>
<span>Guide</span> to the <span>Integral</span> <span>Projection</span>
<span>Model</span></em>. Lecture <span>Notes</span> on
<span>Mathematical</span> <span>Modelling</span> in the
<span>Life</span> <span>Sciences</span>. Cham: Springer International
Publishing. <a href="https://doi.org/10.1007/978-3-319-28893-2" class="external-link">https://doi.org/10.1007/978-3-319-28893-2</a>.
</div>
<div id="ref-guyennon2023" class="csl-entry">
Guyennon, Arnaud, Björn Reineking, Roberto Salguero-Gomez, Jonas
Dahlgren, Aleksi Lehtonen, Sophia Ratcliffe, Paloma Ruiz-Benito, Miguel
A. Zavala, and Georges Kunstler. 2023. <span>“Beyond Mean Fitness:
Demographic Stochasticity and Resilience Matter at Tree Species Climatic
Edges.”</span> <em>Global Ecology and Biogeography</em> n/a (n/a).
https://doi.org/<a href="https://doi.org/10.1111/geb.13640" class="external-link">https://doi.org/10.1111/geb.13640</a>.
</div>
<div id="ref-kunstler2021" class="csl-entry">
Kunstler, Georges, Arnaud Guyennon, Sophia Ratcliffe, Nadja Rüger,
Paloma Ruiz-Benito, Dylan Z. Childs, Jonas Dahlgren, et al. 2021.
<span>“Demographic Performance of European Tree Species at Their Hot and
Cold Climatic Edges.”</span> <em>Journal of Ecology</em> 109 (2):
1041–54. <a href="https://doi.org/10.1111/1365-2745.13533" class="external-link">https://doi.org/10.1111/1365-2745.13533</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://gowachin.github.io/" class="external-link">Maxime Jaunatre</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
