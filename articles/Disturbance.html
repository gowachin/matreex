<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="matreex">
<title>Disturbance models • matreex</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Disturbance models">
<meta property="og:description" content="matreex">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">matreex</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.4.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/matreex.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Disturbance.html">Disturbance models</a>
    <a class="dropdown-item" href="../articles/Harvesting.html">Harvesting models</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/gowachin/matreex" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Disturbance models</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/gowachin/matreexvignettes/Disturbance.Rmd" class="external-link"><code>vignettes/Disturbance.Rmd</code></a></small>
      <div class="d-none name"><code>Disturbance.Rmd</code></div>
    </div>

    
    
<p>This vignette illustrates how to use disturbance scenarii with
<a href="https://github.com/gowachin/matreex" class="external-link">matreex</a> package. A disturbance scenario provides the
timing and intensity at which different types of disturbance (storm,
fire and biotic) will affect tree mortality in each size class. The tree
killed by the disturbance are saved within the harvested output.</p>
<p>The basic <a href="https://github.com/gowachin/matreex" class="external-link">matreex</a> functions are shown in <a href="matreex.html">a previous introduction vignette</a>.</p>
<div class="section level2">
<h2 id="simulations-input">Simulations input<a class="anchor" aria-label="anchor" href="#simulations-input"></a>
</h2>
<div class="section level3">
<h3 id="define-a-species">Define a species<a class="anchor" aria-label="anchor" href="#define-a-species"></a>
</h3>
<p>The first step is the IPM integration and species object creation.
This part is common with basic usage of the package, so nothing is very
important here.</p>
<p><strong>Please keep in mind this computation is intensive and may
take few minutes !</strong></p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/gowachin/matreex" class="external-link">matreex</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load fitted model for a species</span></span>
<span><span class="co"># fit_species # list of all species in dataset</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"fit_Picea_abies"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load associated climate</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"climate_species"</span><span class="op">)</span></span>
<span><span class="va">climate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">climate_species</span>, <span class="va">N</span> <span class="op">==</span> <span class="fl">2</span> <span class="op">&amp;</span> <span class="va">sp</span> <span class="op">==</span> <span class="st">"Picea_abies"</span>, select <span class="op">=</span> <span class="op">-</span><span class="va">sp</span><span class="op">)</span></span>
<span><span class="co"># see ?climate_species to understand the filtering of N.</span></span>
<span><span class="va">climate</span></span>
<span><span class="co">#&gt;        sgdd       wai        sgddb      waib      wai2   sgdd2      PC1</span></span>
<span><span class="co">#&gt; 62 1444.667 0.4519387 0.0006922012 0.6887343 0.2042486 2087062 1.671498</span></span>
<span><span class="co">#&gt;           PC2 N       SDM</span></span>
<span><span class="co">#&gt; 62 0.02602064 2 0.6760556</span></span>
<span></span>
<span><span class="va">Picea_ipm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_IPM.html">make_IPM</a></span><span class="op">(</span></span>
<span>    species <span class="op">=</span> <span class="st">"Picea_abies"</span>, </span>
<span>    climate <span class="op">=</span> <span class="va">climate</span>, </span>
<span>    fit <span class="op">=</span> <span class="va">fit_Picea_abies</span>,</span>
<span>    clim_lab <span class="op">=</span> <span class="st">"optimum clim"</span>, </span>
<span>    mesh <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>m <span class="op">=</span> <span class="fl">700</span>, L <span class="op">=</span> <span class="fl">90</span>, U <span class="op">=</span> <span class="fu"><a href="../reference/get_maxdbh.html">get_maxdbh</a></span><span class="op">(</span><span class="va">fit_Picea_abies</span><span class="op">)</span> <span class="op">*</span> <span class="fl">1.1</span><span class="op">)</span>,</span>
<span>    BA <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">70</span>, <span class="co"># Default values are 0:200, smaller values speed up this vignette.</span></span>
<span>    verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Launching integration loop</span></span>
<span><span class="co">#&gt; GL integration occur on 32 cells</span></span>
<span><span class="co">#&gt; midbin integration occur on 25 cells</span></span>
<span><span class="co">#&gt; Loop done.</span></span>
<span><span class="co">#&gt; Time difference of 48.5 secs</span></span></code></pre></div>
<p>Latter simulations will start at equilibrium, so we compute this
before anything. <code>Picea_equil</code> is the equilibrium
distribution after 2500 years.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Picea_sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/species.html">species</a></span><span class="op">(</span>IPM <span class="op">=</span> <span class="va">Picea_ipm</span>, init_pop <span class="op">=</span> <span class="fu"><a href="../reference/def_initBA.html">def_initBA</a></span><span class="op">(</span><span class="fl">40</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Picea_for</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/forest.html">forest</a></span><span class="op">(</span>species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Picea <span class="op">=</span> <span class="va">Picea_sp</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span><span class="va">Picea_sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_deter_forest.html">sim_deter_forest</a></span><span class="op">(</span><span class="va">Picea_for</span>, tlim <span class="op">=</span> <span class="fl">2500</span>,</span>
<span>                              equil_dist <span class="op">=</span> <span class="fl">250</span>, equil_time <span class="op">=</span> <span class="fl">2500</span>,</span>
<span>                              verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> </span>
<span><span class="co">#&gt; Starting while loop. Maximum t = 2500</span></span>
<span><span class="co">#&gt; time 500 | BA diff : 15.07</span></span>
<span><span class="co">#&gt; time 1000 | BA diff : 6.33</span></span>
<span><span class="co">#&gt; time 1500 | BA diff : 2.80</span></span>
<span><span class="co">#&gt; time 2000 | BA diff : 1.25</span></span>
<span><span class="co">#&gt; time 2500 | BA diff : 0.56</span></span>
<span><span class="co">#&gt; Simulation ended after time 2500</span></span>
<span><span class="co">#&gt; BA stabilized at 36.43 with diff of 0.56 at time 2500</span></span>
<span><span class="co">#&gt; Time difference of 14.7 secs</span></span>
<span></span>
<span><span class="va">Picea_equil</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Picea_sim</span>, <span class="va">var</span> <span class="op">==</span> <span class="st">"n"</span>, <span class="va">equil</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="disturbance">Disturbance<a class="anchor" aria-label="anchor" href="#disturbance"></a>
</h2>
<div class="section level3">
<h3 id="definition-of-disturbance">Definition of disturbance<a class="anchor" aria-label="anchor" href="#definition-of-disturbance"></a>
</h3>
<p>We define a disturbance by few parameters used later in the formula.
Details on the model definition and dataset used can be found in <span class="citation">Barrere et al. (<a href="#ref-Barrere2023" role="doc-biblioref">2023</a>)</span>.</p>
<p>The calibration of the equations of disturbance mortality implemented
in the package is described in details in <span class="citation">Barrere
et al. (<a href="#ref-Barrere2023" role="doc-biblioref">2023</a>)</span>. We characterize a disturbance in
the simulations with two variables:</p>
<ul>
<li><p><span class="math inline">\(I\)</span>, its intensity between 0
and 1.</p></li>
<li><p><span class="math inline">\(type\)</span>, the class of
disturbance. This is a label in <code>"storm"</code>,
<code>"fire"</code> and <code>"biotic"</code>. This is used to filter
species parameters fitted, which were estimated separately for each
disturbance type.</p></li>
</ul>
<p>These variables are set in a data.frame object. A last column named
<strong>IsSurv</strong> is used to inform whether the survival part of
the IPM (competition-induced mortality) is needed during a disturbance.
In <span class="citation">Barrere et al. (<a href="#ref-Barrere2023" role="doc-biblioref">2023</a>)</span>, the model does not differentiate
disturbance mortality and background mortality. Therefore, we recommend
to deactivate baseline mortality to avoid an overestimation of
mortality.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ex_disturb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"storm"</span>, intensity <span class="op">=</span> <span class="fl">0.5</span>, IsSurv <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="impact-on-population">Impact on population<a class="anchor" aria-label="anchor" href="#impact-on-population"></a>
</h3>
<p>The disturbance impact on the population is calculated from
parameters estimated in <span class="citation">Barrere et al. (<a href="#ref-Barrere2023" role="doc-biblioref">2023</a>)</span>. The
disturbance mortality equation takes the size distribution, quadratic
diameter of the species, intensity (<span class="math inline">\(I\)</span>) and duration (<span class="math inline">\(t\)</span>) of the disturbance as inputs. A set of
parameters is associated to each type of disturbance and species. This
is computed with the following equations:</p>
<p><span class="math display">\[
dqm = \sqrt{\frac{\sum_{i=1}^m dbh_i^2 \times n_i}{\sum_{i=1}^m n_i}} \\
\]</span> where <span class="math inline">\(dqm\)</span> is the
quadratic diameter, <span class="math inline">\(m\)</span> is the number
of size classes, and <span class="math inline">\(n_i\)</span> is the
number of trees in the size class and <span class="math inline">\(dbh_i\)</span> is the mean diameter of the size
class (in the model the number of trees is a continuous density per
area).</p>
<p><span class="math display">\[
logratio_i = log(\frac{dbh_i}{dqm}) \\
\]</span> In the original model fitted in <span class="citation">Barrere
et al. (<a href="#ref-Barrere2023" role="doc-biblioref">2023</a>)</span>, <span class="math inline">\(logratio\)</span> and <span class="math inline">\(dbh\)</span> were centered and scaled. The linear
parameters <span class="math inline">\(logratio.intercept\)</span>,
<span class="math inline">\(logratio.slope\)</span>, <span class="math inline">\(dbh.intercept\)</span> and dbh.slope$ are used to
apply the same transformation for these two variables: <span class="math display">\[
dbh.scaled_i = dbh.intercept + dbh_i \times dbh.slope \\
\]</span> <span class="math display">\[
logratio.scaled_i = logratio.intercept + logratio_i \times
logratio.slope \\
\]</span> <span class="math display">\[
Pdeath_{i,t} = 1- (1 - logist(a_0 + a_1 \times logratio.scaled_i + b
\times I*dbh.scaled^{c }))^t
\]</span></p>
<p>Where, <span class="math inline">\(Pdeath_{i,t}\)</span> is the
disturbance probability of mortality over <span class="math inline">\(t\)</span> years of the individual <span class="math inline">\(i\)</span>, of dbh <span class="math inline">\(dbh_i\)</span>. The parameters are estimated with
Bayesian computations. The mean of all posterior estimations are stored
inside the package for each combination of species and disturbance
type.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">Picea_coefs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu">matreex</span><span class="fu">::</span><span class="va"><a href="../reference/disturb_coef.html">disturb_coef</a></span>, <span class="va">species</span> <span class="op">==</span> <span class="st">"Picea_abies"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   disturbance     species        a0         a1        b           c</span></span>
<span><span class="co">#&gt; 1      biotic Picea_abies -5.635219  0.0000000 5.832025 -0.08002929</span></span>
<span><span class="co">#&gt; 2       storm Picea_abies -4.628462 -0.1402871 5.409031  0.00142451</span></span>
<span><span class="co">#&gt;   dbh.intercept   dbh.slope logratio.intercept logratio.slope</span></span>
<span><span class="co">#&gt; 1    -0.7870239 0.007930586        -0.14791154       3.067571</span></span>
<span><span class="co">#&gt; 2    -0.7219773 0.007283356        -0.09485699       2.831488</span></span>
<span><span class="va">Picea_sp</span><span class="op">$</span><span class="va">disturb_coef</span> <span class="op">&lt;-</span> <span class="va">Picea_coefs</span></span></code></pre></div>
<p>Along with this set of parameters, we need to provide a disturbance
function to the species we want to simulate. <em>The species is
initiated with a default empty function that will throw warnings.</em>
The function also require the quadratic mean diameter of the
population.</p>
<p>Below is an example of the difference in size distribution before and
after a disturbance of type <code>"storm"</code> and intensity
<code>0.7</code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Disturbance function</span></span>
<span><span class="fu">matreex</span><span class="fu">::</span><span class="va"><a href="../reference/disturb_fun.html">disturb_fun</a></span></span>
<span><span class="co">#&gt; function (x, species, disturb = NULL, ...) </span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;     dots &lt;- list(...)</span></span>
<span><span class="co">#&gt;     qmd &lt;- dots$qmd</span></span>
<span><span class="co">#&gt;     size &lt;- species$IPM$mesh</span></span>
<span><span class="co">#&gt;     coef &lt;- species$disturb_coef</span></span>
<span><span class="co">#&gt;     disturbance &lt;- NULL</span></span>
<span><span class="co">#&gt;     if (any(disturb$type %in% coef$disturbance)) {</span></span>
<span><span class="co">#&gt;         coef &lt;- subset(coef, disturbance == disturb$type)</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt;     else {</span></span>
<span><span class="co">#&gt;         stop(sprintf("The species %s miss this disturbance type (%s) parameters", </span></span>
<span><span class="co">#&gt;             sp_name(species), disturb$type))</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt;     size[size == 0] &lt;- min(size[size != 0])</span></span>
<span><span class="co">#&gt;     logratio &lt;- log(size/qmd)</span></span>
<span><span class="co">#&gt;     dbh.scaled = coef$dbh.intercept + size * coef$dbh.slope</span></span>
<span><span class="co">#&gt;     logratio.scaled = coef$logratio.intercept + logratio * coef$logratio.slope</span></span>
<span><span class="co">#&gt;     Pkill &lt;- plogis(coef$a0 + coef$a1 * logratio.scaled + coef$b * </span></span>
<span><span class="co">#&gt;         disturb$intensity^(coef$c * dbh.scaled))</span></span>
<span><span class="co">#&gt;     return(x * Pkill)</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; &lt;bytecode: 0x55907a9c9c60&gt;</span></span>
<span><span class="co">#&gt; &lt;environment: namespace:matreex&gt;</span></span>
<span><span class="va">Picea_sp</span><span class="op">$</span><span class="va">disturb_fun</span> <span class="op">&lt;-</span> <span class="va">disturb_fun</span></span></code></pre></div>
<p><img src="Disturbance_files/figure-html/disturb_ex-1.png" width="700"></p>
<p>Any user can define the <code><a href="../reference/disturb_fun.html">disturb_fun()</a></code> function they need
and provide parameters for the wanted species. Obviously, this type of
modification have not been thoroughly tested and thus is more prone to
error so don’t hesitate to contact <a href="https://github.com/gowachin/matreex" class="external-link">matreex</a> maintainer in
this eventuality.</p>
</div>
<div class="section level3">
<h3 id="simulations">Simulations<a class="anchor" aria-label="anchor" href="#simulations"></a>
</h3>
<p>Running a simulation takes the same parameters as usual, with an
added data.frame with disturbance along time. We will start from
equilibrium and have a disturbance after 100 years.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">disturb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"storm"</span>, intensity <span class="op">=</span> <span class="fl">0.2</span>, IsSurv <span class="op">=</span> <span class="cn">FALSE</span>, t <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span></code></pre></div>
<p><strong>Disturbance size distribution is saved in harvest output.
Harvest and basal mortality are canceled when a disturbance
happens.</strong></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Picea_sp</span><span class="op">$</span><span class="va">init_pop</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/def_init_k.html">def_init_k</a></span><span class="op">(</span><span class="va">Picea_equil</span><span class="op">)</span></span>
<span></span>
<span><span class="va">disturb_picea</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_deter_forest.html">sim_deter_forest</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/forest.html">forest</a></span><span class="op">(</span>species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Picea <span class="op">=</span> <span class="va">Picea_sp</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    tlim <span class="op">=</span> <span class="fl">1000</span>, equil_dist <span class="op">=</span> <span class="fl">250</span>, equil_time <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>    disturbance  <span class="op">=</span> <span class="va">disturb</span>, <span class="co"># providing disturbance table</span></span>
<span>    verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Starting while loop. Maximum t = 1000</span></span>
<span><span class="co">#&gt; time 100 | Disturbance : storm I = 0.20</span></span>
<span><span class="co">#&gt; time 500 | BA diff : 21.42</span></span>
<span><span class="co">#&gt; time 1000 | BA diff : 9.29</span></span>
<span><span class="co">#&gt; Simulation ended after time 1000</span></span>
<span><span class="co">#&gt; BA stabilized at 40.57 with diff of 9.29 at time 1000</span></span>
<span><span class="co">#&gt; Time difference of 5.59 secs</span></span>
<span></span>
<span><span class="va">disturb_picea</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">var</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"BAsp"</span>, <span class="st">"H"</span><span class="op">)</span>, <span class="op">!</span> <span class="va">equil</span>, <span class="va">value</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">var</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">.4</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">.4</span><span class="op">)</span></span></code></pre></div>
<p><img src="Disturbance_files/figure-html/sim-1.png" width="700"></p>
<!--
## Delay

I test delay here just to be sure. And there was a bug in get_step_IPM so I was right. 


```r
load_all()
time <- 1500
(disturb <- data.frame(type = "storm", intensity = 0.2, 
                       IsSurv = FALSE, t = 600))
forest_d <- forest(species = list(Abies = delay(Abies_alba, 5)))
set.seed(42)
memor_d <- sim_deter_forest(forest_d, tlim = time,
                                 equil_dist = 250, equil_time = time,
                                 disturbance  = disturb,
                                 harvest = "Uneven", targetBA = 30,
                                 verbose = TRUE, correction = "cut")

memor_d %>%
    filter(var %in% c("BAsp", "N"), ! equil) %>%
    ggplot(aes(x = time, y = value, color = species)) +
    facet_wrap(~ var, scales = "free_y") +
    geom_line(size = .4) + geom_point(size = .4) +
    NULL
```
-->
</div>
<div class="section level3">
<h3 id="multispecific-simulations">Multispecific simulations<a class="anchor" aria-label="anchor" href="#multispecific-simulations"></a>
</h3>
<p>Plurispecific simulations are performed by creating species object
and attributing disturbance function to each species individually as
previously illustrated. The disturbance dataframe is common to all
species included in the simulations. We also change the harvesting model
to illustrate other kind of simulations.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"fit_Fagus_sylvatica"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Fagus_ipm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_IPM.html">make_IPM</a></span><span class="op">(</span></span>
<span>    species <span class="op">=</span> <span class="st">"Fagus_sylvatica"</span>, </span>
<span>    climate <span class="op">=</span> <span class="va">climate</span>, </span>
<span>    fit <span class="op">=</span> <span class="va">fit_Fagus_sylvatica</span>,</span>
<span>    clim_lab <span class="op">=</span> <span class="st">"optimum clim"</span>, </span>
<span>    mesh <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>m <span class="op">=</span> <span class="fl">700</span>, L <span class="op">=</span> <span class="fl">90</span>, U <span class="op">=</span> <span class="fu"><a href="../reference/get_maxdbh.html">get_maxdbh</a></span><span class="op">(</span><span class="va">fit_Fagus_sylvatica</span><span class="op">)</span> <span class="op">*</span> <span class="fl">1.1</span><span class="op">)</span>,</span>
<span>    BA <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">70</span>, </span>
<span>    verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Launching integration loop</span></span>
<span><span class="co">#&gt; GL integration occur on 21 cells</span></span>
<span><span class="co">#&gt; midbin integration occur on 25 cells</span></span>
<span><span class="co">#&gt; Loop done.</span></span>
<span><span class="co">#&gt; Time difference of 26.3 secs</span></span>
<span><span class="va">Fagus_sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/species.html">species</a></span><span class="op">(</span></span>
<span>    IPM <span class="op">=</span> <span class="va">Fagus_ipm</span>, init_pop <span class="op">=</span> <span class="fu"><a href="../reference/def_initBA.html">def_initBA</a></span><span class="op">(</span><span class="fl">30</span><span class="op">)</span>,</span>
<span>    disturb_fun <span class="op">=</span> <span class="va">disturb_fun</span>, </span>
<span>    harvest_fun <span class="op">=</span> <span class="va">Uneven_harv</span>,</span>
<span>    disturb_coef <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu">matreex</span><span class="fu">::</span><span class="va"><a href="../reference/disturb_coef.html">disturb_coef</a></span>, <span class="va">species</span> <span class="op">==</span> <span class="st">"Fagus_sylvatica"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">time</span> <span class="op">&lt;-</span> <span class="fl">1500</span></span>
<span><span class="va">disturb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"storm"</span>, intensity <span class="op">=</span> <span class="fl">0.2</span>, IsSurv <span class="op">=</span> <span class="cn">FALSE</span>, t <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></span>
<span><span class="va">Picea_sp</span><span class="op">$</span><span class="va">harvest_fun</span> <span class="op">&lt;-</span> <span class="va">Uneven_harv</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span><span class="va">disturb_PiFa</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_deter_forest.html">sim_deter_forest</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/forest.html">forest</a></span><span class="op">(</span>species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Picea <span class="op">=</span> <span class="va">Picea_sp</span>, Fagus <span class="op">=</span> <span class="va">Fagus_sp</span><span class="op">)</span>,</span>
<span>           harv_rules <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>Pmax <span class="op">=</span> <span class="fl">0.25</span>, dBAmin <span class="op">=</span> <span class="fl">3</span>, freq <span class="op">=</span> <span class="fl">10</span>, alpha <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>, </span>
<span>    tlim <span class="op">=</span> <span class="fl">1000</span>, equil_dist <span class="op">=</span> <span class="fl">250</span>, equil_time <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>    disturbance  <span class="op">=</span> <span class="va">disturb</span>,</span>
<span>    harvest <span class="op">=</span> <span class="st">"Uneven"</span>, targetBA <span class="op">=</span> <span class="fl">30</span>,</span>
<span>    verbose <span class="op">=</span> <span class="cn">TRUE</span>, correction <span class="op">=</span> <span class="st">"cut"</span><span class="op">)</span></span>
<span><span class="co">#&gt; apply a IPM cut correction</span></span>
<span><span class="co">#&gt; Starting while loop. Maximum t = 1000</span></span>
<span><span class="co">#&gt; time 500 | Disturbance : storm I = 0.20</span></span>
<span><span class="co">#&gt; time 500 | BA diff : 19.10</span></span>
<span><span class="co">#&gt; time 1000 | BA diff : 6.46</span></span>
<span><span class="co">#&gt; Simulation ended after time 1000</span></span>
<span><span class="co">#&gt; BA stabilized at 32.29 with diff of 6.46 at time 1000</span></span>
<span><span class="co">#&gt; Time difference of 9.64 secs</span></span>
<span></span>
<span><span class="va">disturb_PiFa</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">var</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"BAsp"</span>, <span class="st">"H"</span><span class="op">)</span>, <span class="va">time</span> <span class="op">&gt;</span> <span class="fl">450</span> <span class="op">&amp;</span> <span class="va">time</span> <span class="op">&lt;</span> <span class="fl">600</span>, <span class="op">!</span> <span class="va">equil</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">species</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">var</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">.4</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">.4</span><span class="op">)</span></span></code></pre></div>
<p><img src="Disturbance_files/figure-html/nsp_sim-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="linear-stabilizing-effect-of-species-mixture">Linear stabilizing effect of species mixture<a class="anchor" aria-label="anchor" href="#linear-stabilizing-effect-of-species-mixture"></a>
</h3>
<p>When simulating the effect of biotic disturbances on forests mixing
coniferous and broadleaf species, an additional effect can be taken into
account based on the survival models developed by <span class="citation">Brandl et al. (<a href="#ref-Brandl2020" role="doc-biblioref">2020</a>)</span>. This mixture effect is a linear
function, and the mean of the function has been scaled to match the
average mortality disturbance estimated by <span class="citation">Barrere et al. (<a href="#ref-Barrere2023" role="doc-biblioref">2023</a>)</span> for the average share of conifers
in the fitting data.</p>
<p>To include this effect, the probability of disturbance mortality is
multiplied by the linear function linking the share of conifer to biotic
mortality.</p>
<p><span class="math display">\[
f_{mixture.effect}\left(share.conifers\right) = 0.4767 + 0.6015 \cdot
share.conifers \\
\]</span> <span class="math display">\[
Pdeath_{new}\left(share.conifers\right) = Pdeath_{disturb} \cdot
f_{mixture.effect}\left(share.conifers\right)
\]</span></p>
<p>To compute the share of conifers, the type (broadleaf or conifer) of
each species needs to be set as shown below. This can be set when
creating the species object or edited later :</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Picea_sp</span><span class="op">$</span><span class="va">info</span><span class="op">[</span><span class="st">"type"</span><span class="op">]</span></span>
<span><span class="co">#&gt;        type </span></span>
<span><span class="co">#&gt; "Undefined"</span></span>
<span><span class="va">Picea_sp</span><span class="op">$</span><span class="va">info</span><span class="op">[</span><span class="st">"type"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Coniferous"</span></span>
<span><span class="va">Fagus_sp</span><span class="op">$</span><span class="va">info</span><span class="op">[</span><span class="st">"type"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Broadleaf"</span></span></code></pre></div>
<p>An alternative disturbance function is provided by the package as
<code><a href="../reference/disturb_fun_mixt.html">disturb_fun_mixt()</a></code>, to accept the input of the coniferous
percentage computed at the plot scale before disturbing each species and
to modify the mortality probability (<code>Pkill</code>) if the species
is a coniferous.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">matreex</span><span class="fu">::</span><span class="va"><a href="../reference/disturb_fun_mixt.html">disturb_fun_mixt</a></span></span>
<span><span class="co">#&gt; function (x, species, disturb = NULL, ...) </span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;     dots &lt;- list(...)</span></span>
<span><span class="co">#&gt;     qmd &lt;- dots$qmd</span></span>
<span><span class="co">#&gt;     coni_perc &lt;- dots$perc_coni</span></span>
<span><span class="co">#&gt;     size &lt;- species$IPM$mesh</span></span>
<span><span class="co">#&gt;     coef &lt;- species$disturb_coef</span></span>
<span><span class="co">#&gt;     disturbance &lt;- NULL</span></span>
<span><span class="co">#&gt;     if (any(disturb$type %in% coef$disturbance)) {</span></span>
<span><span class="co">#&gt;         coef &lt;- subset(coef, disturbance == disturb$type)</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt;     else {</span></span>
<span><span class="co">#&gt;         stop(sprintf("The species %s miss this disturbance type (%s) parameters", </span></span>
<span><span class="co">#&gt;             sp_name(species), disturb$type))</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt;     size[size == 0] &lt;- min(size[size != 0])</span></span>
<span><span class="co">#&gt;     logratio &lt;- log(size/qmd)</span></span>
<span><span class="co">#&gt;     dbh.scaled = coef$dbh.intercept + size * coef$dbh.slope</span></span>
<span><span class="co">#&gt;     logratio.scaled = coef$logratio.intercept + logratio * coef$logratio.slope</span></span>
<span><span class="co">#&gt;     Pkill &lt;- plogis(coef$a0 + coef$a1 * logratio.scaled + coef$b * </span></span>
<span><span class="co">#&gt;         disturb$intensity^(coef$c * dbh.scaled))</span></span>
<span><span class="co">#&gt;     if (species$info["type"] == "Coniferous" &amp;&amp; disturb$type == </span></span>
<span><span class="co">#&gt;         "biotic") {</span></span>
<span><span class="co">#&gt;         message(sprintf("sp : %s | coni : %.3f | modif : %.2f", </span></span>
<span><span class="co">#&gt;             species$info["species"], coni_perc, (0.4767 + 0.6015 * </span></span>
<span><span class="co">#&gt;                 coni_perc)))</span></span>
<span><span class="co">#&gt;         Pkill &lt;- Pkill * (0.4767 + 0.6015 * coni_perc)</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt;     Pkill &lt;- pmin(Pkill, 1)</span></span>
<span><span class="co">#&gt;     return(x * Pkill)</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; &lt;bytecode: 0x559075506180&gt;</span></span>
<span><span class="co">#&gt; &lt;environment: namespace:matreex&gt;</span></span>
<span><span class="co"># Giving the new disturb_fun</span></span>
<span><span class="va">Picea_sp</span><span class="op">$</span><span class="va">disturb_fun</span> <span class="op">&lt;-</span> <span class="va">disturb_fun_mixt</span></span>
<span><span class="va">Fagus_sp</span><span class="op">$</span><span class="va">disturb_fun</span> <span class="op">&lt;-</span> <span class="va">disturb_fun_mixt</span></span></code></pre></div>
<p>This is an example simulation. Note that it is imperative to apply
this mixture effect with biotic disturbance types only, since this
effect was only calibrated for biotic mortality.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">disturb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"biotic"</span>, intensity <span class="op">=</span> <span class="fl">0.2</span>, IsSurv <span class="op">=</span> <span class="cn">FALSE</span>, t <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span><span class="va">mixture_PiFa</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_deter_forest.html">sim_deter_forest</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/forest.html">forest</a></span><span class="op">(</span>species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Picea <span class="op">=</span> <span class="va">Picea_sp</span>, Fagus <span class="op">=</span> <span class="va">Fagus_sp</span><span class="op">)</span><span class="op">)</span>, </span>
<span>    tlim <span class="op">=</span> <span class="fl">1000</span>, equil_dist <span class="op">=</span> <span class="fl">250</span>, equil_time <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>    disturbance  <span class="op">=</span> <span class="va">disturb</span>,</span>
<span>    harvest <span class="op">=</span> <span class="st">"Uneven"</span>, targetBA <span class="op">=</span> <span class="fl">30</span>,</span>
<span>    verbose <span class="op">=</span> <span class="cn">TRUE</span>, correction <span class="op">=</span> <span class="st">"cut"</span><span class="op">)</span></span>
<span><span class="co">#&gt; apply a IPM cut correction</span></span>
<span><span class="co">#&gt; Starting while loop. Maximum t = 1000</span></span>
<span><span class="co">#&gt; time 500 | Disturbance : biotic I = 0.20</span></span>
<span><span class="co">#&gt; sp : Picea_abies | coni : 0.588 | modif : 0.83</span></span>
<span><span class="co">#&gt; time 500 | BA diff : 18.84</span></span>
<span><span class="co">#&gt; time 1000 | BA diff : 2.82</span></span>
<span><span class="co">#&gt; Simulation ended after time 1000</span></span>
<span><span class="co">#&gt; BA stabilized at 32.58 with diff of 2.82 at time 1000</span></span>
<span><span class="co">#&gt; Time difference of 10.7 secs</span></span>
<span></span>
<span><span class="va">mixture_PiFa</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">var</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"BAsp"</span>, <span class="st">"N"</span><span class="op">)</span>, <span class="op">!</span> <span class="va">equil</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">species</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">var</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">.4</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">.4</span><span class="op">)</span></span></code></pre></div>
<p><img src="Disturbance_files/figure-html/jasper_sim-1.png" width="700"></p>
<p>I compare the two simulations in order to check the presence of a
mixture effect. As seen above in messages, the mortality is multiplied
by 0.74, which we see here with the blue line under the red one for
<em>Picea abies</em>.</p>
<p><em>Yes, the disturbance mortality is saved in the harvest variable
since there is no harvest when there is a disturbance.</em></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span>mixture <span class="op">=</span> <span class="va">mixture_PiFa</span>, basic <span class="op">=</span>  <span class="va">disturb_PiFa</span>, .id <span class="op">=</span> <span class="st">"jasper"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">var</span> <span class="op">==</span> <span class="st">"h"</span>, <span class="va">time</span> <span class="op">==</span> <span class="fl">500</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">mesh</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">jasper</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">species</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">.4</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">.4</span><span class="op">)</span></span></code></pre></div>
<p><img src="Disturbance_files/figure-html/comparaison-1.png" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Barrere2023" class="csl-entry">
Barrere, Julien, Björn Reineking, Thomas Cordonnier, Niko Kulha, Juha
Honkaniemi, Mikko Peltoniemi, Kari T. Korhonen, Paloma Ruiz-Benito,
Miguel A. Zavala, and Georges Kunstler. 2023. <span>“Functional Traits
and Climate Drive Interspecific Differences in Disturbance-Induced Tree
Mortality.”</span> <em>Global Change Biology</em> 29 (10): 2836–51.
https://doi.org/<a href="https://doi.org/10.1111/gcb.16630" class="external-link">https://doi.org/10.1111/gcb.16630</a>.
</div>
<div id="ref-Brandl2020" class="csl-entry">
Brandl, Susanne, Carola Paul, Thomas Knoke, and Wolfgang Falk. 2020.
<span>“The Influence of Climate and Management on Survival Probability
for Germany’s Most Important Tree Species.”</span> <em>Forest Ecology
and Management</em> 458: 117652. https://doi.org/<a href="https://doi.org/10.1016/j.foreco.2019.117652" class="external-link">https://doi.org/10.1016/j.foreco.2019.117652</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://gowachin.github.io/" class="external-link">Maxime Jaunatre</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
